# TASK-0001.1.2.6: User-Friendly Validation Errors

**Parent Story**: [STORY-0001.1.2](README.md)
**Status**: ✅ Complete
**Estimated Hours**: 0.5
**Actual Hours**: 0.5
**Completion Commit**: fec762e (fix: Address PR review - security, docs, UX)

## Objective

Translate Pydantic ValidationError exceptions into user-friendly error messages so developers see clear guidance instead of technical stack traces.

## Context

PR #4 review feedback noted that Pydantic validation errors show technical stack traces when users provide invalid config values. We should catch these and translate them to friendly messages.

## Implementation Checklist

- [ ] Add `ValidationError` exception handler in `src/gitctx/cli/config.py`
- [ ] Create error translation function to map Pydantic errors to user messages
- [ ] Handle common validation cases:
  - Type errors (e.g., string instead of int)
  - Range errors (e.g., value outside gt/le bounds)
  - Required field errors
- [ ] Add unit tests in `tests/unit/cli/test_config.py` for validation error translation
- [ ] Verify existing BDD scenario: "Config validation catches invalid values" shows user-friendly output
- [ ] Run quality gates: `uv run poe fix && uv run poe quality`

## Acceptance Criteria

- Invalid config values show clear, actionable error messages
- Error messages explain what was wrong and what's expected
- Technical Pydantic details are hidden from users
- Exit code 2 used for validation errors (usage error)
- Unit tests verify error translation for common cases
- Existing BDD scenario passes with friendly error text

## Files to Modify

- [src/gitctx/cli/config.py](../../../../../src/gitctx/cli/config.py) - Add validation error handler
- [tests/unit/cli/test_config.py](../../../../../tests/unit/cli/test_config.py) - Add validation error tests

## Technical Notes

**Error Translation Function**:

```python
from pydantic import ValidationError

def translate_validation_error(e: ValidationError, key: str, value: Any) -> str:
    """Translate Pydantic ValidationError to user-friendly message.

    Args:
        e: The ValidationError from Pydantic
        key: Config key that was being set
        value: Value that failed validation

    Returns:
        User-friendly error message
    """
    # Get first error (most relevant)
    error = e.errors()[0]
    error_type = error["type"]

    if error_type == "int_parsing":
        return f"Invalid value '{value}' for {key} - expected a number"
    elif error_type in ("greater_than", "less_than_equal"):
        # Extract constraint from error message
        return f"Invalid value '{value}' for {key} - must be between allowed range"
    elif error_type == "missing":
        return f"Missing required field: {key}"
    else:
        # Generic fallback
        return f"Invalid value '{value}' for {key} - {error['msg']}"
```

**Usage in config.py set command**:

```python
@app.command()
def set(key: str, value: str):
    """Set configuration value."""
    try:
        settings = GitCtxSettings()
        settings.set(key, value)
        console.print(f"[green]✓[/green] set {key}")
    except ValidationError as e:
        error_msg = translate_validation_error(e, key, value)
        console.print(f"[red]✗[/red] {error_msg}")
        raise typer.Exit(2)  # Exit code 2 for validation/usage errors
```

## Test Strategy

**Unit Tests** (`tests/unit/cli/test_config.py`):

```python
def test_set_invalid_type_shows_friendly_error():
    """Setting non-integer for search.limit shows friendly error."""
    # Test that ValidationError is caught and translated

def test_set_out_of_range_shows_friendly_error():
    """Setting value outside range shows friendly error."""
    # Test range validation error translation

def test_validation_error_exits_with_code_2():
    """Validation errors exit with code 2."""
    # Verify exit code for validation failures
```

**BDD Scenario** (verify existing scenario shows friendly text):

```gherkin
Scenario: Config validation catches invalid values
  Given I run "gitctx config init"
  When I run "gitctx config set search.limit invalid"
  Then the exit code should be 2
  And the output should contain "Invalid value 'invalid' for search.limit - expected a number"
  And the output should NOT contain "ValidationError"
  And the output should NOT contain "Traceback"
```

## Definition of Done

- [ ] Error translation function implemented
- [ ] ValidationError handler added to set command
- [ ] Unit tests added and passing
- [ ] BDD scenario updated/verified with friendly error text
- [ ] All quality gates pass
- [ ] Task marked complete in story README
