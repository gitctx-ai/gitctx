# TASK-0001.3.2.1: Write ALL BDD Scenarios (13 total)

**Parent Story**: [STORY-0001.3.2](README.md)
**Status**: ðŸ”µ Not Started
**Estimated Hours**: 3
**Actual Hours**: -

## Objective

Write all 13 BDD scenarios upfront following incremental BDD pattern (TASK-1 = define all behavior). This includes 12 E2E scenarios in Gherkin format and 1 unit test for corrupted database mocking. All scenarios must fail with NotImplementedError after this task.

## BDD Progress

**Before this task**: 0/13 scenarios (none exist)
**After this task**: 0/13 passing (all failing with NotImplementedError)

**Scenarios for this task:**

**E2E Scenarios (12 total):**
1. Unquoted multi-word query
2. Flags before query terms
3. stdin pipeline
4. Results sorted by similarity
5. Result limit
6. No results (empty result set)
7. Search before indexing (exit 8)
8. Empty stdin with no args (exit 2)
9. Invalid limit too low (exit 2)
10. Invalid limit too high (exit 2)
11. Performance p95 latency (<2.0s)

**Unit Test Scenario (1 total):**
12. Corrupted index with TableNotFoundError (requires mocking)

## Implementation Checklist

### Create Feature File
- [ ] Create `tests/e2e/features/search.feature`
- [ ] Copy 12 E2E scenarios from story README (lines 54-130)
- [ ] Ensure concrete Given/When/Then steps (no vague assertions)
- [ ] Verify @performance marker on scenario 12

### Create Step Definition Stubs
- [ ] Create `tests/e2e/steps/search_steps.py`
- [ ] Stub: `@given('an indexed repository')`
- [ ] Stub: `@when('I pipe {text} to {command}')`
- [ ] Stub: `@then('results should match query {query}')`
- [ ] Stub: `@then('results should be sorted by _distance ascending')`
- [ ] Stub: `@then('each result should show cosine similarity score between {min} and {max}')`
- [ ] Stub: `@then('exactly {n:d} results should be shown')`
- [ ] All stubs raise `NotImplementedError("Pending implementation")`

### Create Unit Test for Corrupted Index
- [ ] Create `tests/unit/cli/test_search.py`
- [ ] Write `test_corrupted_index_missing_table()` (from story line 139-150)
- [ ] Mock `lancedb.connect()` to raise `TableNotFoundError`
- [ ] Test marked with `@pytest.mark.skip(reason="Pending TASK-0001.3.2.3")`

### Verification
- [ ] Run: `pytest tests/e2e/features/search.feature -v`
- [ ] Output shows: 12 scenarios, 12 failed (NotImplementedError)
- [ ] Run: `pytest tests/unit/cli/test_search.py -v`
- [ ] Output shows: 1 skipped (pending)
- [ ] All scenarios present in feature file match story README

## Files to Create/Modify

- CREATE: `tests/e2e/features/search.feature` (~80 lines, 12 scenarios)
- CREATE: `tests/e2e/steps/search_steps.py` (~60 lines, 6 stubbed steps)
- CREATE: `tests/unit/cli/test_search.py` (~30 lines, 1 skipped test)

## Pattern Reuse

- `context` fixture (tests/e2e/steps/cli_steps.py:14) - Store BDD state between steps
- Existing `@when('I run "{command}"')` step (tests/e2e/steps/cli_steps.py:27) - Reuse for CLI invocation
- `@pytest.mark.skip` pattern for pending tests

## Dependencies

None - this task only writes test specifications, no implementation

## Notes

This is TASK-1 in incremental BDD pattern:
- Defines WHAT the system should do (all 13 scenarios)
- Does NOT implement HOW it does it (all stubs fail)
- Subsequent tasks will progressively implement steps to pass scenarios
