# TASK-0001.3.3.2: Create Formatter Protocol + Registry (TDD)

**Parent Story**: [STORY-0001.3.3](README.md)
**Status**: ðŸ”µ Not Started
**Estimated Hours**: 3
**Actual Hours**: -

## Objective

Create the ResultFormatter protocol and FORMATTERS registry with comprehensive unit tests. This provides the foundation for all formatter implementations.

## BDD Progress

**Before this task**: 0/7 scenarios passing
**After this task**: 1/7 scenarios passing (zero results test)

**Scenarios for this task:**
- Scenario 5: Zero results display (partial - basic structure allows this to pass)

## Implementation Checklist

### Unit Tests First (TDD - RED)
- [ ] Create `tests/unit/formatters/test_base.py`
- [ ] Write test: `test_result_formatter_protocol_has_required_attributes`
- [ ] Write test: `test_result_formatter_protocol_has_format_method`
- [ ] Write test: `test_formatter_format_method_signature`
- [ ] Create `tests/unit/formatters/test_registry.py`
- [ ] Write test: `test_get_formatter_returns_terse_by_default`
- [ ] Write test: `test_get_formatter_returns_verbose`
- [ ] Write test: `test_get_formatter_returns_mcp`
- [ ] Write test: `test_get_formatter_unknown_raises_value_error`
- [ ] Write test: `test_get_formatter_error_message_lists_available`
- [ ] Run tests - all fail âœ“

### Implementation (GREEN)
- [ ] Create `src/gitctx/formatters/` directory
- [ ] Create `src/gitctx/formatters/base.py` with ResultFormatter protocol
  - `name: str` attribute
  - `description: str` attribute
  - `format(results: list[dict], console: Console) -> None` method
- [ ] Create `src/gitctx/formatters/__init__.py`
- [ ] Add `FORMATTERS: dict[str, ResultFormatter]` (initially empty)
- [ ] Add `get_formatter(name: str) -> ResultFormatter` function
  - Raises ValueError if formatter not found
  - Error message lists available formatters
- [ ] Run tests - all pass âœ“

### Refactor
- [ ] Add docstrings to all functions and classes
- [ ] Add type hints to all functions
- [ ] Run mypy - no errors

### BDD Implementation
- [ ] Implement basic step for zero results test (just returns empty list)
- [ ] Run BDD tests - Scenario 5 passes (1/7) âœ“

### Verification
- [ ] All unit tests pass
- [ ] Mypy passes
- [ ] Ruff check passes
- [ ] Code coverage >90% for formatters module
- [ ] BDD: 1/7 scenarios passing

## Files to Create/Modify

- **CREATE**: `src/gitctx/formatters/base.py` (~30 lines, protocol definition)
- **CREATE**: `src/gitctx/formatters/__init__.py` (~40 lines, registry + get_formatter)
- **CREATE**: `tests/unit/formatters/test_base.py` (~50 lines, protocol tests)
- **CREATE**: `tests/unit/formatters/test_registry.py` (~80 lines, registry tests)
- **MODIFY**: `tests/e2e/steps/test_formatting_steps.py` (implement 1 step for zero results)

## Pattern Reuse

- **Protocol pattern** - Similar to ChunkerProtocol, VectorStoreProtocol
- **Registry pattern** - Dict-based lookup like other component registries
- **Rich Console** - Standard output mechanism

## TDD Approach

1. **RED**: Write failing tests for protocol attributes and registry lookup
2. **GREEN**: Implement minimal protocol and registry to pass tests
3. **REFACTOR**: Add docstrings, improve error messages
4. **BDD**: Implement one step to get first scenario passing

## Success Criteria

- [ ] ResultFormatter protocol defined with name, description, format()
- [ ] FORMATTERS registry exists (empty dict initially)
- [ ] get_formatter() function works with clear error messages
- [ ] 10+ unit tests passing
- [ ] Code coverage >90%
- [ ] 1/7 BDD scenarios passing
- [ ] Commit: `feat(TASK-0001.3.3.2): Create formatter protocol and registry (1/7 BDD passing)`
