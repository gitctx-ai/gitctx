# TASK-0001.3.3.1: Write ALL BDD Scenarios (7 total)

**Parent Story**: [STORY-0001.3.3](README.md)
**Status**: ✅ Complete
**Estimated Hours**: 3
**Actual Hours**: 1.5

## Objective

Write all 7 BDD scenarios for result formatting with stubbed step definitions. This defines WHAT the system should do before implementing HOW it does it (incremental BDD pattern).

## BDD Progress

**Before this task**: 0/7 scenarios (none exist)
**After this task**: 0/7 scenarios passing (all stubbed, all failing RED)

**Scenarios for this task:**
- Scenario 1: Default terse output format
- Scenario 2: HEAD commit marked with symbol
- Scenario 3: Verbose output with syntax highlighting
- Scenario 4: MCP output with structured markdown
- Scenario 5: Zero results display
- Scenario 6: Conflicting output flags rejected
- Scenario 7: Unknown language fallback to markdown

## Implementation Checklist

### Create Feature File
- [ ] Check if `tests/e2e/features/search.feature` exists from STORY-0001.3.2
  - If exists: Append scenarios with `@formatting` tag
  - If not exists: Create new file with feature header
- [ ] Copy 7 scenarios from story README (lines 70-132, section "## BDD Scenarios") to `tests/e2e/features/search.feature`
- [ ] Ensure Gherkin syntax is correct (Given/When/Then)
- [ ] Add `@formatting` tag to feature or scenario level
- [ ] Scenarios use concrete values (example: `"each line should match pattern: .*:\d+:\d\.\d\d .*"` not `"output should be formatted nicely"`)

### Create Step Definition Stubs
- [ ] Create `tests/e2e/steps/test_formatting_steps.py`
- [ ] Add pytest_bdd imports: `from pytest_bdd import given, when, then, scenarios`
- [ ] Each stub decorated with appropriate `@given`/`@when`/`@then` and step text
- [ ] Each stub function raises `NotImplementedError('Step not implemented: <step_text>')`
- [ ] Stub step: `@given("an indexed repository")`
- [ ] Stub step: `@given("an indexed repository with HEAD and historic commits")`
- [ ] Stub step: `@given("an indexed repository with unknown file type (.xyz)")`
- [ ] Stub step: `@when('I run "gitctx search {query}"')`
- [ ] Stub step: `@when('I run "gitctx search {query} --verbose"')`
- [ ] Stub step: `@when('I run "gitctx search {query} --mcp"')`
- [ ] Stub step: `@when('I run "gitctx search {query} --mcp --verbose"')`
- [ ] Stub step: `@then("the exit code should be {code}")`
- [ ] Stub step: `@then("each line should match pattern: {pattern}")`
- [ ] Stub step: `@then("output should contain commit SHA")`
- [ ] Stub step: `@then("output should contain author name")`
- [ ] Stub step: `@then("output should contain commit date")`
- [ ] Stub step: `@then('output should contain results summary: "{pattern}"')`
- [ ] Stub step: `@then('HEAD results should show "●" or "[HEAD]" marker')`
- [ ] Stub step: `@then("historic results should have no marker")`
- [ ] Stub step: `@then("output should contain syntax-highlighted code blocks")`
- [ ] Stub step: `@then("code blocks should show line numbers")`
- [ ] Stub step: `@then("output should contain file paths with line ranges")`
- [ ] Stub step: `@then('output should start with "---"')`
- [ ] Stub step: `@then('output should contain "results:"')`
- [ ] Stub step: `@then("YAML frontmatter should parse successfully")`
- [ ] Stub step: `@then('YAML should contain "file_path" keys')`
- [ ] Stub step: `@then("output should contain code blocks with language tags")`
- [ ] Stub step: `@then('the output should contain "0 results in"')`
- [ ] Stub step: `@then('the output should contain "Error"')`
- [ ] Stub step: `@then('the output should contain "mutually exclusive"')`
- [ ] Stub step: `@then('syntax highlighting should use "markdown" language')`
- [ ] Stub step: `@then("code should still be displayed with formatting")`
- [ ] All stubs raise `NotImplementedError` with descriptive message

### Verification
- [ ] Run: `uv run pytest tests/e2e/features/search.feature -k formatting -v`
- [ ] All 7 scenarios should show `FAILED` status with `NotImplementedError: Step not implemented` in pytest output (expected RED state)
- [ ] Verify count: `7 failed` in pytest summary
- [ ] No syntax errors in feature file (pytest should parse Gherkin successfully)
- [ ] No import errors in step definitions (NotImplementedError should be raised, not ImportError)

## Files to Create/Modify

- **MODIFY or CREATE**: `tests/e2e/features/search.feature`
  - If exists from STORY-0001.3.2: Append 7 @formatting scenarios (~120 lines)
  - If not exists: Create new file with Feature header + 7 scenarios (~140 lines)
- **CREATE**: `tests/e2e/steps/test_formatting_steps.py` (~200 lines, all stubs with pytest_bdd decorators)

## Pattern Reuse

- **e2e_git_repo_factory** (`tests/e2e/conftest.py:262`) - For creating test repositories
- **e2e_cli_runner** (`tests/e2e/conftest.py:135`) - For running CLI commands
- **VCR cassettes** (`tests/e2e/conftest.py:370`) - For recording OpenAI API responses

## Dependencies

- STORY-0001.3.2 must be complete (search command must exist)
- Feature file may need to be created or extended

## Success Criteria

- [ ] 7 BDD scenarios written in Gherkin
- [ ] All step definitions stubbed (raise NotImplementedError)
- [ ] Running scenarios produces 7 failures (RED state)
- [ ] No syntax errors
- [ ] Commit: `test(TASK-0001.3.3.1): Write BDD scenarios for result formatting (0/7 stubbed)`
