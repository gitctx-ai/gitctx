# TASK-0001.3.3.1: Write ALL BDD Scenarios (7 total)

**Parent Story**: [STORY-0001.3.3](README.md)
**Status**: üîµ Not Started
**Estimated Hours**: 3
**Actual Hours**: -

## Objective

Write all 7 BDD scenarios for result formatting with stubbed step definitions. This defines WHAT the system should do before implementing HOW it does it (incremental BDD pattern).

## BDD Progress

**Before this task**: 0/7 scenarios (none exist)
**After this task**: 0/7 scenarios passing (all stubbed, all failing RED)

**Scenarios for this task:**
- Scenario 1: Default terse output format
- Scenario 2: HEAD commit marked with symbol
- Scenario 3: Verbose output with syntax highlighting
- Scenario 4: MCP output with structured markdown
- Scenario 5: Zero results display
- Scenario 6: Conflicting output flags rejected
- Scenario 7: Unknown language fallback to markdown

## Implementation Checklist

### Create Feature File
- [ ] Copy 7 scenarios from story README (lines 56-117) to `tests/e2e/features/search.feature`
- [ ] Ensure Gherkin syntax is correct (Given/When/Then)
- [ ] Add `@formatting` tag to feature
- [ ] Scenarios use concrete values (not "should be fast" but actual checks)

### Create Step Definition Stubs
- [ ] Create `tests/e2e/steps/test_formatting_steps.py`
- [ ] Stub step: `@given("an indexed repository")`
- [ ] Stub step: `@given("an indexed repository with HEAD and historic commits")`
- [ ] Stub step: `@given("an indexed repository with unknown file type (.xyz)")`
- [ ] Stub step: `@when('I run "gitctx search {query}"')`
- [ ] Stub step: `@when('I run "gitctx search {query} --verbose"')`
- [ ] Stub step: `@when('I run "gitctx search {query} --mcp"')`
- [ ] Stub step: `@when('I run "gitctx search {query} --mcp --verbose"')`
- [ ] Stub step: `@then("the exit code should be {code}")`
- [ ] Stub step: `@then("each line should match pattern: {pattern}")`
- [ ] Stub step: `@then("output should contain commit SHA")`
- [ ] Stub step: `@then("output should contain author name")`
- [ ] Stub step: `@then("output should contain commit date")`
- [ ] Stub step: `@then('output should contain results summary: "{pattern}"')`
- [ ] Stub step: `@then('HEAD results should show "‚óè" or "[HEAD]" marker')`
- [ ] Stub step: `@then("historic results should have no marker")`
- [ ] Stub step: `@then("output should contain syntax-highlighted code blocks")`
- [ ] Stub step: `@then("code blocks should show line numbers")`
- [ ] Stub step: `@then("output should contain file paths with line ranges")`
- [ ] Stub step: `@then('output should start with "---"')`
- [ ] Stub step: `@then('output should contain "results:"')`
- [ ] Stub step: `@then("YAML frontmatter should parse successfully")`
- [ ] Stub step: `@then('YAML should contain "file_path" keys')`
- [ ] Stub step: `@then("output should contain code blocks with language tags")`
- [ ] Stub step: `@then('the output should contain "0 results in"')`
- [ ] Stub step: `@then('the output should contain "Error"')`
- [ ] Stub step: `@then('the output should contain "mutually exclusive"')`
- [ ] Stub step: `@then('syntax highlighting should use "markdown" language')`
- [ ] Stub step: `@then("code should still be displayed with formatting")`
- [ ] All stubs raise `NotImplementedError` with descriptive message

### Verification
- [ ] Run: `uv run pytest tests/e2e/features/search.feature -k formatting -v`
- [ ] All 7 scenarios fail with NotImplementedError (expected RED state)
- [ ] No syntax errors in feature file
- [ ] No import errors in step definitions

## Files to Create

- **CREATE**: `tests/e2e/features/search.feature` (append 7 scenarios, ~120 lines)
  - Note: This file may already exist from STORY-0001.3.2, append to it
- **CREATE**: `tests/e2e/steps/test_formatting_steps.py` (~200 lines, all stubs)

## Pattern Reuse

- **e2e_git_repo_factory** (`tests/e2e/conftest.py:262`) - For creating test repositories
- **e2e_cli_runner** (`tests/e2e/conftest.py:135`) - For running CLI commands
- **VCR cassettes** (`tests/e2e/conftest.py:370`) - For recording OpenAI API responses

## Dependencies

- STORY-0001.3.2 must be complete (search command must exist)
- Feature file may need to be created or extended

## Success Criteria

- [ ] 7 BDD scenarios written in Gherkin
- [ ] All step definitions stubbed (raise NotImplementedError)
- [ ] Running scenarios produces 7 failures (RED state)
- [ ] No syntax errors
- [ ] Commit: `test(TASK-0001.3.3.1): Write BDD scenarios for result formatting (0/7 stubbed)`
