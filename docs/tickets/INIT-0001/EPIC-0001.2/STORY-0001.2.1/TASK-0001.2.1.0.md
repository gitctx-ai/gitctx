# TASK-0001.2.1.0: Extend Config Schema for Walker Settings

**Parent**: [STORY-0001.2.1](README.md)
**Status**: ðŸ”µ Not Started
**Estimated Hours**: 3
**Actual Hours**: -

## Implementation Checklist

- [ ] Extend `IndexSettings` in `src/gitctx/core/config.py`
  - [ ] Add `max_blob_size_mb: int = Field(default=5, gt=0, le=100)`
  - [ ] Add `default_refs: List[str] = Field(default_factory=lambda: ["HEAD"])`
  - [ ] Add `respect_gitignore: bool = Field(default=True)`
  - [ ] Add `skip_binary: bool = Field(default=True)`
- [ ] Update config schema documentation
- [ ] Add tests for new settings in `tests/unit/core/test_config.py`
  - [ ] Test default values
  - [ ] Test validation (max_blob_size_mb must be 1-100)
  - [ ] Test YAML parsing with new fields
  - [ ] Test precedence (env vars â†’ YAML â†’ defaults)
- [ ] Update `.gitctx/config.yml` schema example in docs
- [ ] Tests pass
- [ ] Documentation updated

## Why This Task Exists

STORY-0001.1.2 (Configuration System) was implemented before walker requirements were fully known. Now that we're implementing the walker, we know it needs configurable settings:

- **max_blob_size_mb**: Repo preference for blob size filtering (some repos need 10MB, others 1MB)
- **default_refs**: Which branches/tags to index by default (team decision)
- **respect_gitignore**: Whether to honor .gitignore rules (affects index contents)
- **skip_binary**: Whether to skip binary files (affects embedding storage)

These belong in the config system as **repo-level settings** (`.gitctx/config.yml`), not hardcoded in walker.

## Updated Config Schema

**Before** (current `IndexSettings` in `RepoConfig`):
```python
class IndexSettings(BaseModel):
    chunk_size: int = Field(default=1000, gt=0)
    chunk_overlap: int = Field(default=200, ge=0)
```

**After** (with walker settings):
```python
class IndexSettings(BaseModel):
    # Chunking settings (STORY-0001.2.2)
    chunk_size: int = Field(default=1000, gt=0)
    chunk_overlap: int = Field(default=200, ge=0)

    # Walker settings (STORY-0001.2.1)
    max_blob_size_mb: int = Field(default=5, gt=0, le=100, description="Maximum blob size to index (MB)")
    default_refs: List[str] = Field(default_factory=lambda: ["HEAD"], description="Git refs to index by default")
    respect_gitignore: bool = Field(default=True, description="Skip gitignored files")
    skip_binary: bool = Field(default=True, description="Skip binary files")
```

## Environment Variable Support

Following existing config precedence pattern:

```bash
# Override max blob size
GITCTX_INDEX_MAX_BLOB_SIZE_MB=10 gitctx index

# Override default refs
GITCTX_INDEX_DEFAULT_REFS='["HEAD","refs/tags/*"]' gitctx index
```

## Test Requirements

**Unit Tests** (tests/unit/core/test_config.py):
- Default values load correctly
- YAML parsing works with new fields
- Validation catches invalid values (e.g., max_blob_size_mb=0)
- Environment variable override works
- Precedence order correct

## Verification Criteria

- New settings appear in `IndexSettings` dataclass
- Default values match walker requirements
- YAML files can set these values (repo-level: `.gitctx/config.yml`)
- Environment variables can override
- Validation prevents invalid values
- Tests pass
- Config schema documentation updated

## Files to Modify

- `src/gitctx/core/config.py` - Add fields to IndexSettings in RepoConfig
- `tests/unit/core/test_config.py` - Add tests for new fields
- `docs/tickets/INIT-0001/EPIC-0001.1/STORY-0001.1.2/README.md` - Document schema extension (optional note)

## Dependencies

- STORY-0001.1.2 (Configuration System) complete âœ…

---

**Created**: 2025-10-06
**Last Updated**: 2025-10-06
