# TASK-0001.2.1.3: Location Metadata Collection

**Parent**: [STORY-0001.2.1](README.md)
**Status**: ðŸ”µ Not Started
**Estimated Hours**: 6
**Actual Hours**: -

## Implementation Checklist

- [ ] Build HEAD tree blob set on walker initialization
  - [ ] `head_blobs: Set[str] = set()`
  - [ ] Walk HEAD tree, collect all blob SHAs
  - [ ] For bare repos: set head_blobs = empty set
- [ ] For each blob in each commit:
  - [ ] Create BlobLocation instance
  - [ ] Set commit_sha, file_path
  - [ ] Compute is_head via `blob_sha in head_blobs` (O(1) lookup)
  - [ ] Extract commit metadata (author_name, author_email, commit_date, commit_message, is_merge)
  - [ ] Add to blob_locations[blob_sha]
- [ ] Handle bare repository edge case
  - [ ] Detect bare repo (no HEAD working tree)
  - [ ] Set is_head = False for all blobs
- [ ] Build BlobRecord with complete location list
- [ ] Performance validation (HEAD tree build <100ms)
- [ ] Tests pass
- [ ] Documentation updated

## Pattern Reuse

**Existing Fixtures:**
- `bare_repo_fixture` - Test bare repository handling (new fixture)
- `e2e_git_repo_factory` - Create repos with blobs in/out of HEAD

## Test Requirements

**Unit Tests** (tests/unit/core/test_location_tracking.py):
- is_head = True for HEAD blobs
- is_head = False for historical blobs
- Correct file paths tracked
- Commit metadata accuracy (author, date, message, is_merge)
- HEAD tree build performance (<100ms for 1K blobs)
- Bare repository: all is_head = False

## Verification Criteria

- BlobLocation includes complete commit context
- is_head correctly identifies current vs historical blobs
- Bare repositories handled gracefully (no HEAD tree error)
- Performance: HEAD tree build adds <100ms overhead

## Files to Create/Modify

- `src/gitctx/core/commit_walker.py` (extend - add location tracking)
- `src/gitctx/core/models.py` (extend - BlobLocation dataclass)
- `tests/unit/core/test_location_tracking.py` (new)

## Dependencies

- TASK-0001.2.1.1 complete (commit traversal)
- TASK-0001.2.1.2 complete (blob deduplication provides locations dict)

---

**Created**: 2025-10-06
**Last Updated**: 2025-10-06
