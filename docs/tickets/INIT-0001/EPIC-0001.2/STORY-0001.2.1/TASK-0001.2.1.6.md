# TASK-0001.2.1.6: BDD Scenarios & Integration Tests

**Parent**: [STORY-0001.2.1](README.md)
**Status**: ðŸ”µ Not Started
**Estimated Hours**: 10
**Actual Hours**: -

## Implementation Checklist

- [ ] Create test fixture repos (with pygit2 or git commands)
  - [ ] Repo with duplicate blobs across commits
  - [ ] Repo with merge commits
  - [ ] Repo with binary files
  - [ ] Repo with large files (>5MB)
  - [ ] Repo with .gitignore rules
  - [ ] Repo with multiple refs (branches)
- [ ] Write 10 Gherkin scenarios in commit_walker.feature
  - [ ] Blob deduplication across commits
  - [ ] Merge commit detection
  - [ ] HEAD blob filtering
  - [ ] Binary file exclusion
  - [ ] Large blob exclusion
  - [ ] Resume from partial index
  - [ ] Multiple refs
  - [ ] Progress reporting
  - [ ] Gitignore filtering
  - [ ] Graceful error handling
- [ ] Implement step definitions for each scenario
  - [ ] Use e2e_git_repo_factory for repo creation
  - [ ] Use e2e_git_isolation_env for git operations
  - [ ] Verify BlobRecord contents
  - [ ] Verify location metadata
  - [ ] Verify progress callbacks
- [ ] Integration test with real git repo (if available)
- [ ] Performance test: 10K commits in <30 seconds
- [ ] Memory test: Peak memory <150MB
- [ ] All tests pass
- [ ] Documentation updated

## Pattern Reuse

**Existing Fixtures:**
- `e2e_git_repo_factory` (tests/e2e/conftest.py:254) - Create custom test repos
- `e2e_git_isolation_env` (tests/e2e/conftest.py:41) - Isolated git environment
- `e2e_cli_runner` (tests/e2e/conftest.py:135) - CLI runner (if needed for integration)

**Test Patterns to Follow:**
- BDD structure from tests/e2e/features/config.feature
- Step definitions from tests/e2e/steps/cli_steps.py

## Test Requirements

**BDD Scenarios** (tests/e2e/features/commit_walker.feature):
- All 10 scenarios from story README
- Each scenario exercises one acceptance criterion
- Use realistic git repo structures

**Integration Tests**:
- Real repo smoke test (use actual gitctx repo if available)
- Performance benchmark (10K commits <30s)
- Memory profiling (peak <150MB)

**Edge Case Unit Tests** (from TASK-0001.2.1.1):
- 6 edge case tests already written in other tasks

## Verification Criteria

- All 10 BDD scenarios pass
- Step definitions reuse existing patterns
- Performance targets met (10K commits <30s)
- Memory targets met (peak <150MB for 10K commits)
- Integration with real repo successful
- Test coverage >90% for commit_walker module

## Files to Create/Modify

- `tests/e2e/features/commit_walker.feature` (new)
- `tests/e2e/step_defs/test_commit_walker.py` (new)
- `tests/fixtures/test_repos.py` (new - helper to create test repos)

## Dependencies

- TASK-0001.2.1.1 through 0001.2.1.5 complete (full walker implementation)

---

**Created**: 2025-10-06
**Last Updated**: 2025-10-06
