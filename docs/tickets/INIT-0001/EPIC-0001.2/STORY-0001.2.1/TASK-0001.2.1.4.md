# TASK-0001.2.1.4: Blob Filtering

**Parent**: [STORY-0001.2.1](README.md)
**Status**: ðŸ”µ Not Started
**Estimated Hours**: 7
**Actual Hours**: -

## Implementation Checklist

- [ ] Parse .gitignore from HEAD tree using pathspec library
- [ ] Create pathspec.PathSpec from .gitignore patterns
- [ ] Always exclude .git/ and .gitctx/ directories
- [ ] Implement binary detection (null byte check)
  - [ ] `is_binary = b'\0' in blob_data[:8192]`
  - [ ] Fast, git-compatible heuristic
- [ ] Implement Git LFS pointer detection
  - [ ] Check for `version https://git-lfs.github.com/spec` header
  - [ ] Skip with warning if LFS pointer found
- [ ] Implement size limit filtering
  - [ ] Skip blobs > max_blob_size_mb * 1024 * 1024
  - [ ] Log warning to WalkStats.errors
- [ ] All filtering happens before yielding BlobRecord
- [ ] Tests pass
- [ ] Documentation updated

## Pattern Reuse

**Existing Fixtures:**
- `e2e_git_repo_factory` - Create repos with binary files, large files, gitignore

**New Fixtures Needed:**
- `test_repo_with_lfs_pointers` - Repo with Git LFS pointer files

## Test Requirements

**Unit Tests** (tests/unit/core/test_filtering.py):
- .gitignore patterns respected (*.pyc, node_modules/)
- Binary files skipped (null byte detection)
- Git LFS pointers detected and skipped
- Large files skipped (size limit)
- .git/ and .gitctx/ always excluded
- Text files pass filter

## Verification Criteria

- Gitignore rules applied to all commits (historical and current)
- Binary files reliably detected (null byte heuristic)
- LFS pointer files skipped with warning
- Oversized blobs skipped with error logged
- Security: .git/ and .gitctx/ never indexed

## Files to Create/Modify

- `src/gitctx/core/blob_filter.py` (new)
- `src/gitctx/core/commit_walker.py` (extend - integrate filtering)
- `tests/unit/core/test_filtering.py` (new)

## Dependencies

- pathspec>=0.11.0 (gitignore pattern matching)
- TASK-0001.2.1.2 complete (blob deduplication provides blobs to filter)

---

**Created**: 2025-10-06
**Last Updated**: 2025-10-06
