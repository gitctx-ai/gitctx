# TASK-0001.2.1.2: Blob Deduplication Logic

**Parent**: [STORY-0001.2.1](README.md)
**Status**: ðŸ”µ Not Started
**Estimated Hours**: 6
**Actual Hours**: -

## Implementation Checklist

- [ ] Maintain `seen_blobs: Set[str]` for O(1) dedup checks
- [ ] Maintain `blob_locations: Dict[str, List[BlobLocation]]` for location accumulation
- [ ] On first blob encounter:
  - [ ] Add blob SHA to seen_blobs
  - [ ] Yield BlobRecord with sha, content, size
  - [ ] Initialize blob_locations[sha] = []
- [ ] On subsequent blob encounter (same SHA):
  - [ ] Skip yielding (already yielded)
  - [ ] Continue accumulating locations
- [ ] Support resume from partial index
  - [ ] Pre-seed seen_blobs with already_indexed set
  - [ ] Skip already-indexed blobs entirely
- [ ] Build BlobRecord with complete locations list
- [ ] Memory efficiency validation (Set vs List)
- [ ] Tests pass
- [ ] Documentation updated

## Pattern Reuse

**Existing Fixtures:**
- `e2e_git_repo_factory` - Create repos with duplicate blobs across commits

**Similar Patterns:**
- Set-based deduplication is standard Python pattern (no new abstraction needed)

## Test Requirements

**Unit Tests** (tests/unit/core/test_deduplication.py):
- Blob appears in 50 commits, yielded once
- All 50 locations captured in BlobRecord
- Deduplication across multiple refs
- Resume from partial index (pre-seeded seen_blobs)
- Memory efficiency (Set vs List benchmark)

## Verification Criteria

- Blob yielded exactly once regardless of commit count
- All blob locations tracked in BlobRecord.locations
- Already-indexed blobs skipped (not yielded, not re-processed)
- O(1) dedup check performance (Set membership)

## Files to Create/Modify

- `src/gitctx/core/commit_walker.py` (extend - add dedup logic)
- `src/gitctx/core/models.py` (extend - BlobRecord dataclass)
- `tests/unit/core/test_deduplication.py` (new)

## Dependencies

- TASK-0001.2.1.1 complete (commit traversal provides blobs)

---

**Created**: 2025-10-06
**Last Updated**: 2025-10-06
