# TASK-0001.4.4.1: Write BDD Scenarios for Compression Transparency

**Parent Story**: [STORY-0001.4.4](README.md)
**Status**: ✅ Complete
**Estimated Hours**: 2
**Actual Hours**: 2

## Objective

Write complete BDD test suite with 2 scenarios in Gherkin format and stubbed step definitions. This task defines WHAT the compression system should do before implementing HOW it does it.

## BDD Progress

**Before this task**: No BDD scenarios exist
**After this task**: 0/2 scenarios passing (all stubbed, all failing as expected)

**Scenarios for this task:**
- Scenario 1: Embedding cache compressed on disk
- Scenario 2: Decompression transparent to search

## Implementation Checklist

### Create Feature File
- [x] Add scenarios to existing `tests/e2e/features/embedding.feature` (reused existing file)
- [x] Write Scenario 7: "Embedding cache compressed on disk"
  - [x] Given I have a test repository with 10 Python files
  - [x] When I index the repository
  - [x] And I check the .gitctx/embeddings/ directory
  - [x] Then cache files should have .safetensors.zst extension
  - [x] And cache size should be approximately 8% smaller than uncompressed
- [x] Write Scenario 8: "Decompression transparent to search"
  - [x] Given I have indexed a repository with compressed cache
  - [x] When I search for "authentication"
  - [x] Then search results should be returned correctly
  - [x] And decompression overhead should be minimal

### Create Step Definition Stubs
- [x] Add stubs to existing `tests/e2e/steps/test_embedding.py` (reused existing file)
- [x] Stub step: "Given I have a test repository with {num_files:d} Python files" → raise NotImplementedError
- [x] Stub step: "When I index the repository" → raise NotImplementedError
- [x] Stub step: "When I check the .gitctx/embeddings/ directory" → raise NotImplementedError
- [x] Stub step: "Then cache files should have .safetensors.zst extension" → raise NotImplementedError
- [x] Stub step: "Then cache size should be approximately 8% smaller than uncompressed" → raise NotImplementedError
- [x] Stub step: "Given I have indexed a repository with compressed cache" → raise NotImplementedError
- [x] Stub step: "When I search for {query}" → raise NotImplementedError
- [x] Stub step: "Then search results should be returned correctly" → raise NotImplementedError
- [x] Stub step: "Then decompression overhead should be minimal" → raise NotImplementedError

### Verification
- [x] Run pytest tests/e2e/test_embedding_features.py (compression scenarios)
- [x] Both scenarios fail with NotImplementedError (expected)
- [x] Commit: "test(TASK-0001.4.4.1): Add BDD scenarios for compression (2 scenarios, 0/2 stubbed)"

## Files to Create

- CREATE: `tests/e2e/features/compression.feature` (~30 lines, 2 scenarios)
- CREATE: `tests/e2e/steps/test_compression.py` (~50 lines, stubbed steps)

## Pattern Reuse

- **BDD structure**: `tests/e2e/features/` and `tests/e2e/steps/` (existing pattern)
- **pytest-bdd conventions**: Follow existing feature file structure from other scenarios
- **Scenario format**: Use concrete Given/When/Then steps (no vague language)

## Notes

- Compression is an implementation detail, so only 2 BDD scenarios needed (vs 9 for chunking)
- Focus on observable behavior: file extension and transparency to search
- All steps should be concrete and measurable (no "reasonable time" or "fast enough")
