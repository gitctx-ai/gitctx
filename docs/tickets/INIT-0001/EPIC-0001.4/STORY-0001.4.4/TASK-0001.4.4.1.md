# TASK-0001.4.4.1: Write BDD Scenarios for Compression Transparency

**Parent Story**: [STORY-0001.4.4](README.md)
**Status**: ðŸ”µ Not Started
**Estimated Hours**: 2
**Actual Hours**: -

## Objective

Write complete BDD test suite with 2 scenarios in Gherkin format and stubbed step definitions. This task defines WHAT the compression system should do before implementing HOW it does it.

## BDD Progress

**Before this task**: No BDD scenarios exist
**After this task**: 0/2 scenarios passing (all stubbed, all failing as expected)

**Scenarios for this task:**
- Scenario 1: Embedding cache compressed on disk
- Scenario 2: Decompression transparent to search

## Implementation Checklist

### Create Feature File
- [ ] Create `tests/e2e/features/compression.feature`
- [ ] Write Scenario 1: "Embedding cache compressed on disk" (lines 29-36 from story)
  - [ ] Given I index a repository with 100 files
  - [ ] When I check the .gitctx/embeddings/ directory
  - [ ] Then cache files should have .safetensors.zst extension
  - [ ] And total cache size should be ~11MB (8% smaller than uncompressed 12MB)
- [ ] Write Scenario 2: "Decompression transparent to search" (lines 38-45 from story)
  - [ ] Given I have indexed a repository with compressed cache
  - [ ] When I search for "authentication"
  - [ ] Then search results should be identical to uncompressed cache
  - [ ] And decompression should add <100ms to search time

### Create Step Definition Stubs
- [ ] Create `tests/e2e/steps/test_compression.py`
- [ ] Stub step: "Given I index a repository with 100 files" â†’ raise NotImplementedError
- [ ] Stub step: "When I check the .gitctx/embeddings/ directory" â†’ raise NotImplementedError
- [ ] Stub step: "Then cache files should have .safetensors.zst extension" â†’ raise NotImplementedError
- [ ] Stub step: "And total cache size should be ~11MB" â†’ raise NotImplementedError
- [ ] Stub step: "Given I have indexed a repository with compressed cache" â†’ raise NotImplementedError
- [ ] Stub step: "When I search for {query}" â†’ raise NotImplementedError
- [ ] Stub step: "Then search results should be identical to uncompressed cache" â†’ raise NotImplementedError
- [ ] Stub step: "And decompression should add <100ms to search time" â†’ raise NotImplementedError

### Verification
- [ ] Run pytest tests/e2e/features/compression.feature
- [ ] Both scenarios fail with NotImplementedError (expected)
- [ ] Commit: "test(TASK-0001.4.4.1): Write BDD scenarios for compression (0/2 stubbed)"

## Files to Create

- CREATE: `tests/e2e/features/compression.feature` (~30 lines, 2 scenarios)
- CREATE: `tests/e2e/steps/test_compression.py` (~50 lines, stubbed steps)

## Pattern Reuse

- **BDD structure**: `tests/e2e/features/` and `tests/e2e/steps/` (existing pattern)
- **pytest-bdd conventions**: Follow existing feature file structure from other scenarios
- **Scenario format**: Use concrete Given/When/Then steps (no vague language)

## Notes

- Compression is an implementation detail, so only 2 BDD scenarios needed (vs 9 for chunking)
- Focus on observable behavior: file extension and transparency to search
- All steps should be concrete and measurable (no "reasonable time" or "fast enough")
